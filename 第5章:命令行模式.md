## 技巧27 结识Vim命令行模式

命令行模式会提示我们输入一条Ex命令、一个查找模式,或一个表达式.

如何进入命令行模式?

* `:`会将Vim切换到命令行模式
* `/`调出查找提示符切换到命令行模式
* `<C-r>=`访问表达式寄存器时，也会进去命令行模式

操作缓冲区文本的额Ex命令

```
命令                             用途
:[range]delete [x]              删除指定范围内的行[到寄存器x中]
:[range]yank [x]                复制指定范围的行[到寄存器x中]
:[line]put [x]                  在指定行后粘贴寄存器x中的内容
:[range]copy {address}          在指定范围内的行拷贝到{address}所指定的行之下
:[range]move {address}          在指定范围内的行移动到{address}所指定的行之下
:[range]join                    连接指定范围内的行
:[range]normal {commands}       对指定范围的每一行执行普通模式下的命令{commands}
:[range]substitute/{pattern}    把指定范围的出现{pattern}的地方替换成{string}
/ {string}/[flags]              
:[range]global/{pattern}/[cmd]  对指定范围内匹配{pattern}的所有行，在其上执行Ex命令{cmd}

```

## 技巧28 在一行或多个连续行上执行命令

构建Ex命令的地址及范围的符号

```
符号    地址
1      文件的第一行
$      文件的最后一行
0      虚拟行,位于文件一行上方
.      光标所在行
'm     包含位置标记m的行
'<     高亮选区的起始行
'>     高亮选区的结束行
%      整个文件(:1,$的简写形式)
```

1. 第0行在文件中并不存在,但它作为一个地址，可以把指定范围的行复制或移动到开头.   
   * `:copy{address}`, `:move{address}`

2. 用行号作为地址.
   * `:行号`,移动到某一行
3. 用地址指定一个范围
   * `:2,5p`,将2至5行范围的内容打印出来 (p即为print)
   * `:{start},{end}`
4. 用高亮选区指定范围
   * 行的可视模式下选定行范围
   * `:`进入命令行模式后，会自动生成`'<,'>`来代表高亮选区的范围
5. 用模式指定范围
   * 例如:`:/<html>/,/<\/html>/p`,以`<html>`标签所在行开始，`</html>`标签所在行结束
6. 用偏移地址对范围进行修正
   * 例如`:/<html>/+1,/<\/html>/-1p`,不包括`<html>`，`</html>`标签所在行
   * 偏移地址表达方式即为`{address}n`



## 技巧29 使用`:t`和`:m`命令复制和移动行

### 复制行

```
命令       用途
:6t.      把第6行复制到当前行下方
:t6       把当前行复制到第6行下方
:t.       为当前行创建一个副本(类似于普通模式下的yyp)
:t$       把当前行复制到文本结尾
:t6       把当前行复制到第6行下方
:'<,'>t0  把高亮选中的行复制到文件开头

```

1. `:[range]t{address}`，`:[range]copy {address}`, `:[range]co {address}`
   * 把range范围中的行copy到给出的行地址下方
   * `:copy`可以简写为`:co`，或者简写为`:t`

### 移动行

1. `:[range]m{address}`,`:[range]move{address}`
     * 把range范围中的行移动到给出的行地址下方
     * `:move`可以简写为`:m`

     
     
## 技巧30 在指定范围上执行普通模式命令

1. `[range]normal {commands}`
2. `:%normal A;` 符号`%`代表整个文件范围，整个文件所有行末尾都添加`;`在做此修改时会自动进入插入模式，添加完分号后，再回到普通模式。

## 技巧31 重复上次的Ex命令
1. 如果想要重复上次的Ex命令的话，使用`@:`

## 技巧32 自动补全Ex命令
1. `<C-d>`命令会让Vim显示可用的补全列表，此时多次按`<Tab>`进行补全项命令的遍历
2. `<Tab>`补全命令

## 技巧33 把当前单词插入到命令行
1. 在命令行模式下，`<C-r><C-w>`用于将光标下的单词插入命令行

## 技巧34 回溯历史命令

1.  `<Up>`向上, `<Down>`向下对历史Ex命令进行回溯
2. `xx<Up>`,`xx<Down>`,对以`xx`开头的Ex命令进行回溯（即只能`xx`开头的命令过滤出来进行回溯）
3. `<C-p>`作用相当于`<Up>`, `<C-n>`作用相当于`<Down>`,但不能过滤`xx`开头的命令。
4. 在普通模式下按`q:`进去命令行窗口

```
命令         动作
q/          打开查找命令历史的命令行窗口
q:          打开Ex命令的命令行窗口
<Ctrl-f>    从命令行模式企鹅黄到命令窗口

```
## 技巧35 运行Shell命令

### 执行Shell中的程序

1. `:!{cmd}`只适合执行一次性命令
   * `:!ls`,执行Shell的`ls`命令。在Vim的命令行模式中，给命令加一个`!`就可以调用外部程序
   * `:!ruby %`,执行当前的ruby文件.`符号%代表当前的文件`
   
2. 执行多条Shell命令，
   * 第一种:可以在Vim中执行`:shell`命令开启shell会话,`exit`命令退出shell回到vim
   * 第二种:在vim的普通模式下`<Ctr-z>`挂起vim进程，进入shell。shell命令`$jobs`查看当前作业列表(可以看到vim被挂起)，`fg`唤醒vim进程回到vim。
   * 第二种更加方便--根据自己的喜好进行选择

常用的调用shell命令

```
命令                         用途
:shell                      启动一个shell (输入exit返回vim)
:!{cmd}                     在shell中执行{cmd}
:read !{cmd}                在shell中执行{cmd},并把其标准输出插入到光标下方
:[range]write !{cmd}        在shell中执行{cmd},，以 [range]作为标准输入
:[range]!{filter}           使用外部程序 {filter}过滤指定的[range]


```
  